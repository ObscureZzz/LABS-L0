<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Поиск заказа</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #ffffff;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
    }
    .container {
      background: #d243ff;
      padding: 30px 40px;
      margin-top: 50px;
      border-radius: 12px;
      box-shadow: 0 8px 20px rgba(93, 2, 129, 0.137);
      width: 90%;
      max-width: 900px;
    }
    h1 {
      text-align: center;
      color: #e7e7e7;
      margin-bottom: 30px;
    }
    .search-bar {
      display: flex;
      color: #a73afd;
      justify-content: center;
      margin-bottom: 25px;
    }
    .search-bar input {
      flex: 1;
      padding: 12px 15px;
      font-size: 16px;
      font-weight: 700;
      border-radius: 15px 0 0 15px;
      border: 1px solid #7702d1;
      border-right: 0px;
      outline: none;
    }
    .search-bar button {
      padding: 12px 25px;
      font-size: 16px;
      font-weight: 700;
      border: 1px solid #7702d1;
      border-left:0px;
      background-color: #a73afd;
      color: #fff;
      cursor: pointer;
      border-radius: 0 15px 15px 0;
      transition: background 0.3s;
    }
    .search-bar button:hover {
      border-radius: 0 15px 15px 0;
      background-color: #b14efd;
    }
    .result {
      margin-top: 20px;
    }
    .order-card {
      background: #ffffff;
      padding: 20px 25px;
      border-radius: 8px;
      margin-bottom: 15px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.05);
    }
    .order-card h2 {
      margin-top: 0;
      color: #b14efd;
    }
    .order-card p {
      margin: 5px 30px;
    }
    .section-title {
      font-weight: bold;
      margin-top: 15px;
      color: #444;
      border-top: 1px solid #ddd;
      padding-bottom: 3px;
    }
    .items-list {
      list-style: none;
      padding: 0;
      margin: 5px 5px 0px 30px;
    }
    .items-list li {
      padding: 6px 0;
      border-bottom: 1px solid #eee;
    }
    .json-box {
      background: #272822;
      color: #f8f8f2;
      padding: 15px;
      border-radius: 8px;
      margin-top: 20px;
      overflow-x: auto;
      font-family: monospace;
      font-size: 14px;
      max-height: 400px;
    }
    .error {
      color: #ffffff;
      text-align: center;
      font-weight: bold;
      margin-top: 15px;
    }
    .loading {
      text-align: center;
      color: #555;
      font-style: italic;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Поиск заказа</h1>
    <div class="search-bar">
      <input type="text" id="orderUid" placeholder="Введите order_uid" />
      <button id="searchBtn">Найти</button>
    </div>
    <div id="result" class="result"></div>
  </div>

  <script>
    const searchBtn = document.getElementById('searchBtn');
    const orderUidInput = document.getElementById('orderUid');
    const resultDiv = document.getElementById('result');

    searchBtn.addEventListener('click', fetchOrder);
    orderUidInput.addEventListener('keypress', e => {
      if (e.key === 'Enter') fetchOrder();
    });

    function fetchOrder() {
      const uid = orderUidInput.value.trim();
      if (!uid) {
        resultDiv.innerHTML = '<p class="error">Введите order_uid</p>';
        return;
      }

      resultDiv.innerHTML = '<p class="loading">Идёт поиск...</p>';

      fetch(`http://localhost:3000/orders/${uid}`)
        .then(response => {
          if (!response.ok) {
            throw new Error('Заказ не найден');
          }
          return response.json();
        })
        .then(order => {
          const html = `
            <div class="order-card">
              <h2>Заказ: ${order.order_uid}</h2>
              <p><strong>Трек номер:</strong> ${order.track_number}</p>
              <p><strong>Покупатель:</strong> ${order.customer_id}</p>
              <p><strong>Сервис доставки:</strong> ${order.delivery_service}</p>
              <p><strong>Локаль:</strong> ${order.locale}</p>
              <p><strong>Дата создания:</strong> ${new Date(order.date_created).toLocaleString()}</p>
              
              <p class="section-title">Доставка</p>
              <p>${order.delivery.name}</p>
              <p>${order.delivery.phone}</p>
              <p>${order.delivery.address}, ${order.delivery.city}, ${order.delivery.region}, ${order.delivery.zip}</p>
              <p>Email: ${order.delivery.email}</p>

              <p class="section-title">Оплата</p>
              <p>Транзакция: ${order.payment.transaction}</p>
              <p>Провайдер: ${order.payment.provider}</p>
              <p>Сумма: ${order.payment.amount} ${order.payment.currency}</p>
              <p>Банк: ${order.payment.bank}</p>
              <p>Доставка: ${order.payment.delivery_cost}</p>
              <p>Товары: ${order.payment.goods_total}</p>

              <p class="section-title">Товары</p>
              <ul class="items-list">
                ${order.items && order.items.length > 0 
                  ? order.items.map(item => `
                    <li>
                      <strong>${item.name}</strong> — ${item.brand}<br>
                      Цена: ${item.price} ${order.payment.currency}, скидка: ${item.sale}%<br>
                      Артикул: ${item.nm_id}, статус: ${item.status}
                    </li>`).join('')
                  : '<li>Нет товаров</li>'}
              </ul>

              <p class="section-title">JSON данных заказа</p>
              <div class="json-box">${syntaxHighlight(JSON.stringify(order, null, 2))}</div>
            </div>
          `;
          resultDiv.innerHTML = html;
        })
        .catch(err => {
          resultDiv.innerHTML = `<p class="error">${err.message}</p>`;
        });
    }

    function syntaxHighlight(json) {
      json = json.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
      return json.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(?:\s*:)?|\b(true|false|null)\b|\b\d+\b)/g, match => {
        let cls = 'number';
        if (/^"/.test(match)) {
          if (/:$/.test(match)) {
            cls = 'key';
          } else {
            cls = 'string';
          }
        } else if (/true|false/.test(match)) {
          cls = 'boolean';
        } else if (/null/.test(match)) {
          cls = 'null';
        }
        return `<span class="${cls}">${match}</span>`;
      });
    }
  </script>
</body>
</html>
